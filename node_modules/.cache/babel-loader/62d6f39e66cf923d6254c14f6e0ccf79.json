{"ast":null,"code":"import _asyncToGenerator from\"/Users/admin/Documents/MyPrograms/ReactProject/social-network-demo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/admin/Documents/MyPrograms/ReactProject/social-network-demo/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/admin/Documents/MyPrograms/ReactProject/social-network-demo/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/admin/Documents/MyPrograms/ReactProject/social-network-demo/node_modules/@babel/runtime/regenerator/index.js\";import{userAPI}from\"../api/api\";import{updateObjectInArray}from\"../units/validators/object-helpers\";var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET_USERS';var SET_CURRENT_PAGE='SET_CURRENT_PAGE';var SET_TOTAL_COUNT='SET_TOTAL_COUNT';var TOGGLE_IS_FECHING='TOGGLE_IS_FECHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:5,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:true})// users: state.users.map(u=>{\n//     if (u.id === action.userId) {\n//         return {...u, followed:true}\n//     }\n//     return u;\n// })\n});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:false})});case SET_USERS:{//return { ...state, users:[...state.users, ...action.users] }\nreturn _objectSpread(_objectSpread({},state),{},{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});}case SET_TOTAL_COUNT:{return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.count});}case TOGGLE_IS_FECHING:{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_PROGRESS:{return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});}default:return state;}};// ACTION Creator\nexport var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalCount=function setTotalCount(totalUsersCount){return{type:SET_TOTAL_COUNT,count:totalUsersCount};};export var toggletIsFetching=function toggletIsFetching(isFetching){return{type:TOGGLE_IS_FECHING,isFetching:isFetching};};export var toggleFollowingInProgress=function toggleFollowingInProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var getUsers=function getUsers(page,pageSize,pageNumber){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispach){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispach(toggletIsFetching(true));_context.next=3;return userAPI.requestUsers(page,pageSize);case 3:data=_context.sent;dispach(toggletIsFetching(false));dispach(setUsers(data.items));dispach(setTotalCount(data.totalCount));dispach(setCurrentPage(page));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispach,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispach(toggleFollowingInProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode==0){dispach(actionCreator(userId));}dispach(toggleFollowingInProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispach){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispach,userId,userAPI.follow.bind(userAPI),followSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispach){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispach,userId,userAPI.unfollow.bind(userAPI),unfollowSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/Users/admin/Documents/MyPrograms/ReactProject/social-network-demo/src/redux/users-reducer.js"],"names":["userAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_COUNT","TOGGLE_IS_FECHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","count","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalCount","toggletIsFetching","toggleFollowingInProgress","getUsers","page","pageNumber","dispach","requestUsers","data","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import { userAPI } from \"../api/api\";\nimport { updateObjectInArray } from \"../units/validators/object-helpers\";\n\nconst FOLLOW = 'FOLLOW';\nconst UNFOLLOW = 'UNFOLLOW';\nconst SET_USERS = 'SET_USERS';\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\nconst SET_TOTAL_COUNT = 'SET_TOTAL_COUNT';\nconst TOGGLE_IS_FECHING = 'TOGGLE_IS_FECHING';\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\n\nlet initialState = {\n    users: [ ],\n    pageSize: 5,\n    totalUsersCount:0,\n    currentPage: 1,\n    isFetching: true,\n    followingInProgress: []\n}\n\nconst usersReducer = (state = initialState, action) => {\n\n    switch (action.type) {\n        case FOLLOW:\n            return {\n                ...state, \n               users: updateObjectInArray(state.users, action.userId, \"id\", {followed:true})\n               \n                // users: state.users.map(u=>{\n                //     if (u.id === action.userId) {\n                //         return {...u, followed:true}\n                //     }\n                //     return u;\n                // })\n            }\n        case UNFOLLOW:\n            return {\n                ...state, \n                users: updateObjectInArray(state.users, action.userId, \"id\", {followed:false})\n            }\n        case SET_USERS: {\n            //return { ...state, users:[...state.users, ...action.users] }\n            return { ...state, users:action.users }\n        }\n        case SET_CURRENT_PAGE: {       \n            return { ...state, currentPage: action.currentPage }\n        }\n        case SET_TOTAL_COUNT: {       \n            return { ...state,  totalUsersCount: action.count }\n        }\n        case TOGGLE_IS_FECHING: {       \n            return { ...state,  isFetching: action.isFetching }\n        }\n        case TOGGLE_IS_FOLLOWING_PROGRESS: {       \n            return { ...state,  \n                followingInProgress: action.isFetching\n                ? [...state.followingInProgress, action.userId]\n                : state.followingInProgress.filter(id => id!= action.userId) }\n        }\n        default:\n            return state;\n    }\n}\n// ACTION Creator\nexport const followSuccess = (userId) => ({ type: FOLLOW, userId })\nexport const unfollowSuccess = (userId) => ({ type: UNFOLLOW, userId })\nexport const setUsers = (users) => ({ type: SET_USERS, users })\nexport const setCurrentPage = (currentPage) => ({type: SET_CURRENT_PAGE, currentPage})\nexport const setTotalCount = ( totalUsersCount) => ({ type: SET_TOTAL_COUNT,  count: totalUsersCount })\nexport const toggletIsFetching = (isFetching) => ({type: TOGGLE_IS_FECHING, isFetching})\nexport const toggleFollowingInProgress = (isFetching, userId) => ({type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId})\n\nexport const getUsers = (page,pageSize,pageNumber ) => async (dispach) => {\n   dispach(toggletIsFetching(true));\n\n    let data = await userAPI.requestUsers(page, pageSize)\n        dispach(toggletIsFetching(false))\n        dispach(setUsers(data.items));\n        dispach(setTotalCount(data.totalCount));\n        dispach(setCurrentPage(page))\n  \n}\n \nconst followUnfollowFlow = async (dispach, userId, apiMethod, actionCreator) =>{\n    dispach(toggleFollowingInProgress(true, userId));\n    let response = await apiMethod(userId)\n            if (response.data.resultCode == 0) {\n                dispach(actionCreator(userId)); \n            }\n            dispach(toggleFollowingInProgress(false, userId));\n}\n\nexport const follow = (userId ) => async (dispach) => {\n\n        followUnfollowFlow(dispach, userId, userAPI.follow.bind(userAPI), followSuccess);\n }\n\n export const unfollow = (userId ) => async (dispach) => {\n\n    followUnfollowFlow(dispach, userId, userAPI.unfollow.bind(userAPI), unfollowSuccess);\n    \n }\n\nexport default usersReducer;"]},"metadata":{},"sourceType":"module"}